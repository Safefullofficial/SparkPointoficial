<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SparkPoint</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <div class="container">
            <div class="logo">‚ö° SparkPoint</div>
            <div class="wallet-section">
                <span id="wallet">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</span>
                <button id="connect" class="btn-gold">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
            </div>
        </div>
    </nav>

    <div class="container main">
        <div class="sidebar">
            <div class="card">
                <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
                <div id="profile"><p>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫</p></div>
            </div>
            <div class="card">
                <h3>üí∞ –ë–∞–ª–∞–Ω—Å</h3>
                <div class="balance"><h2 id="balance">0 BNB</h2></div>
            </div>
            <div class="card">
                <h3>üìä –£—Ä–æ–≤–µ–Ω—å</h3>
                <div class="level">
                    <span id="level" class="level-badge">0</span>
                    <div class="progress"><div id="progress-bar"></div></div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="card">
                <h3>üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</h3>
                <div class="referral">
                    <input type="text" id="ref-link" readonly>
                    <button onclick="copyLink()" class="btn-gold">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>

            <div class="card" id="register-card">
                <h3>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <input type="text" id="upline" placeholder="–ê–¥—Ä–µ—Å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—è">
                <button onclick="register()" class="btn-green">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (0.1 BNB)</button>
            </div>

            <div class="card" id="stats-card" style="display: none;">
                <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats">
                    <div class="stat"><h4 id="refs">0</h4><p>–†–µ—Ñ–µ—Ä–∞–ª—ã</p></div>
                    <div class="stat"><h4 id="team">0</h4><p>–ö–æ–º–∞–Ω–¥–∞</p></div>
                    <div class="stat"><h4 id="earned">0</h4><p>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</p></div>
                </div>
            </div>

            <div class="card admin-card" id="admin-panel" style="display: none;">
                <h3>‚öôÔ∏è –ê–¥–º–∏–Ω</h3>
                <input type="text" id="new-user" placeholder="–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
                <input type="text" id="new-upline" placeholder="–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å">
                <button onclick="addFree()" class="btn-green">–î–æ–±–∞–≤–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <script>
        let web3, contract, user;
        const CONTRACT_ADDRESS = "–í–ê–®_–ê–î–†–ï–°_–ö–û–ù–¢–†–ê–ö–¢–ê"; 
        const CONTRACT_ABI = []; 

        async function connectWallet() {
            if (window.ethereum) {
                try {
                    web3 = new Web3(window.ethereum);
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    user = accounts[0];
                    document.getElementById('wallet').textContent = user.slice(0, 6) + '...' + user.slice(-4);
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    loadData();
                } catch (e) { console.log("–í—Ö–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω"); }
            } else { alert("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask"); }
        }

        async function loadData() {
            try {
                const userData = await contract.methods.users(user).call();
                if (userData && userData.active) {
                    document.getElementById('profile').innerHTML = `<p>–£—Ä–æ–≤–µ–Ω—å: ${userData.level}</p>`;
                    document.getElementById('balance').textContent = web3.utils.fromWei(userData.balance, 'ether') + ' BNB';
                    document.getElementById('level').textContent = userData.level;
                    document.getElementById('refs').textContent = userData.referrals;
                    document.getElementById('team').textContent = userData.totalTeam;
                    document.getElementById('earned').textContent = web3.utils.fromWei(userData.balance, 'ether') + ' BNB';
                    
                    document.getElementById('register-card').style.display = 'none';
                    document.getElementById('stats-card').style.display = 'block';
                    
                    const admin = await contract.methods.admin().call();
                    if (user.toLowerCase() === admin.toLowerCase()) {
                        document.getElementById('admin-panel').style.display = 'block';
                    }
                }
            } catch (e) { console.log("–ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"); }
        }

        function copyLink() {
            const link = document.getElementById('ref-link');
            link.select();
            document.execCommand('copy');
            alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
        }

        document.getElementById('connect').onclick = connectWallet;
    </script>
</body>
</html>
