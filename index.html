<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SparkPoint</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: #1a1a1a; margin: 10% auto; padding: 20px; border: 1px solid #ffcc00; width: 85%; max-width: 500px; border-radius: 15px; color: #fff; }
        .close { color: #aaa; float: right; font-size: 28px; cursor: pointer; }
        .rules-text { font-size: 14px; line-height: 1.5; color: #ccc; margin-top: 15px; }
        .rules-item { margin-bottom: 10px; border-left: 2px solid #ffcc00; padding-left: 10px; }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <div class="logo">‚ö° SparkPoint</div>
            <div class="wallet-section">
                <span id="wallet">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</span>
                <button id="connect" class="btn-gold">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
            </div>
        </div>
    </nav>

    <div class="container main">
        <div class="sidebar">
            <div class="card">
                <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
                <div id="profile"><p>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫</p></div>
            </div>
            <div class="card">
                <h3>üí∞ –ë–∞–ª–∞–Ω—Å</h3>
                <div class="balance"><h2 id="balance">0 BNB</h2></div>
            </div>
            <div class="card">
                <h3>üìä –£—Ä–æ–≤–µ–Ω—å</h3>
                <div id="level-display" class="level">
                    <span id="level" class="level-badge">0</span>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="card" id="register-card">
                <h3>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <input type="text" id="upline" placeholder="–ê–¥—Ä–µ—Å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—è">
                
                <div style="margin: 15px 0; font-size: 13px; color: #aaa; display: flex; align-items: flex-start;">
                    <input type="checkbox" id="accept-rules" style="margin-top: 4px; margin-right: 10px;" onchange="toggleRegButton()">
                    <label for="accept-rules">–ú–Ω–µ –µ—Å—Ç—å 21+ –ª–µ—Ç –∏ —è –ø—Ä–∏–Ω–∏–º–∞—é <a href="#" onclick="openModal(); return false;" style="color: #ffcc00; text-decoration: underline;">–ø—Ä–∞–≤–∏–ª–∞ –∏ —É—Å–ª–æ–≤–∏—è –ø—Ä–æ–µ–∫—Ç–∞</a></label>
                </div>

                <button id="reg-button" onclick="register()" class="btn-green" disabled style="opacity: 0.5;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (0.1 BNB)</button>
            </div>

            <div class="card" id="stats-card" style="display: none;">
                <h3>üìà –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats">
                    <div class="stat"><h4 id="refs">0</h4><p>–†–µ—Ñ–µ—Ä–∞–ª—ã</p></div>
                    <div class="stat"><h4 id="team">0</h4><p>–ö–æ–º–∞–Ω–¥–∞</p></div>
                    <div class="stat"><h4 id="earned">0</h4><p>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</p></div>
                </div>
                <div style="margin-top: 20px;">
                    <p>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</p>
                    <input type="text" id="ref-link" readonly style="width: 70%; padding: 5px;">
                    <button onclick="copyLink()" class="btn-gold" style="padding: 5px 10px;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>

            <div class="card admin-card" id="admin-panel" style="display: none;">
                <h3>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                <input type="text" id="new-user" placeholder="–ê–¥—Ä–µ—Å –Ω–æ–≤–æ–≥–æ —é–∑–µ—Ä–∞">
                <input type="text" id="new-upline" placeholder="–ê–¥—Ä–µ—Å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—è">
                <button onclick="addFree()" class="btn-green">–î–æ–±–∞–≤–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 style="color: #ffcc00;">üìú –ü—Ä–∞–≤–∏–ª–∞ SparkPoint</h2>
            <div class="rules-text">
                <div class="rules-item"><b>–ù–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è:</b> –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —è–≤–ª—è–µ—Ç—Å—è –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∏–≥—Ä–æ–π. –ú—ã –Ω–µ –æ–±–µ—â–∞–µ–º –¥–æ—Ö–æ–¥.</div>
                <div class="rules-item"><b>21+:</b> –ü—Ä–æ–µ–∫—Ç –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω –ª–∏—Ü–∞–º –º–ª–∞–¥—à–µ 21 –≥–æ–¥–∞.</div>
                <div class="rules-item"><b>–†–∏—Å–∫–∏:</b> –í—ã –Ω–µ—Å–µ—Ç–µ –ø–æ–ª–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞. –í–∑–Ω–æ—Å—ã 0.1 BNB —è–≤–ª—è—é—Ç—Å—è –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω—ã–º–∏.</div>
                <div class="rules-item"><b>–ê–≤—Ç–æ-–∞–ø–≥—Ä–µ–π–¥:</b> –í—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å, —á—Ç–æ —á–∞—Å—Ç—å –±–∞–ª–∞–Ω—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –≤–∞—à–µ–≥–æ —É—Ä–æ–≤–Ω—è.</div>
            </div>
            <button onclick="closeModal()" class="btn-gold" style="width: 100%; margin-top: 15px;">–Ø—Å–Ω–æ</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <script>
        let web3, contract, user;
        const CONTRACT_ADDRESS = "–í–ê–®_–ê–î–†–ï–°_–ü–û–°–õ–ï_–î–ï–ü–õ–û–Ø"; 
        const CONTRACT_ABI = []; // –°—é–¥–∞ –≤—Å—Ç–∞–≤–∏—à—å ABI –∏–∑ Remix

        function toggleRegButton() {
            const isChecked = document.getElementById('accept-rules').checked;
            const btn = document.getElementById('reg-button');
            btn.disabled = !isChecked;
            btn.style.opacity = isChecked ? "1" : "0.5";
        }

        function openModal() { document.getElementById("rulesModal").style.display = "block"; }
        function closeModal() { document.getElementById("rulesModal").style.display = "none"; }

        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                user = accounts[0];
                document.getElementById('wallet').textContent = user.slice(0, 6) + '...' + user.slice(-4);
                contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                loadData();
            } else { alert("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask!"); }
        }

        async function loadData() {
            try {
                const userData = await contract.methods.users(user).call();
                if (userData.active) {
                    document.getElementById('register-card').style.display = 'none';
                    document.getElementById('stats-card').style.display = 'block';
                    document.getElementById('balance').textContent = web3.utils.fromWei(userData.balance, 'ether') + ' BNB';
                    document.getElementById('level').textContent = userData.level;
                    document.getElementById('refs').textContent = userData.referrals;
                    document.getElementById('team').textContent = userData.totalTeam;
                    document.getElementById('earned').textContent = web3.utils.fromWei(userData.balance, 'ether') + ' BNB';
                    document.getElementById('ref-link').value = window.location.origin + window.location.pathname + "?ref=" + user;

                    const admin = await contract.methods.admin().call();
                    if (user.toLowerCase() === admin.toLowerCase()) {
                        document.getElementById('admin-panel').style.display = 'block';
                    }
                }
            } catch (e) { console.log("–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –≤—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã"); }
        }

        function copyLink() {
            const copyText = document.getElementById("ref-link");
            copyText.select();
            document.execCommand("copy");
            alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        }

        document.getElementById('connect').onclick = connectWallet;
    </script>
</body>
</html>
